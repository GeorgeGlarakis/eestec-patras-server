# HTTP
server {
    # Port to listen on
    listen 80; # IPv4
    listen [::]:80; # IPv6

    # This config is only valid for the ec subdomain
    server_name eestec.ece.upatras.gr www.eestec.ece.upatras.gr;

    # We need this for getting certificates
    # location ^~ /.well-known/acme-challenge/ {
    #    allow all;
    #    root /docker/certbot/;
    #    default_type "text/plain";
    #    try_files $uri = 404;
    #  }

    # Always redirect to the HTTPS version of the site (except for the above)
    # location / {
    # return 301 https://eestecpatras.gr$request_uri;
    # }

    # Set the root folder of the website
    root /docker/eestec-site;

    # Set the index of the site
    index index.php;

    # Set the location for the SSA_WS page
    location / {
	    try_files $uri $uri/ /index.php$is_args$args;
    }

    # PHP files have to be forwarded to the SSA_WS container
    location ~ \.php$ {
        try_files $uri =404;

        fastcgi_split_path_info ^(.+\.php)(/.+)$;
        fastcgi_index index.php;

        fastcgi_param PATH_INFO       $fastcgi_path_info;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include /etc/nginx/fastcgi_params;

        fastcgi_pass eestec-site.docker:{{ fastcgi_port }};
     }
}